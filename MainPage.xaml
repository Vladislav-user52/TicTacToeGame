<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:TicTacToeGame"
             x:Class="TicTacToeGame.UnifiedMainPage"
             Title="Крестики-нолики">
    
    <!-- ОДИН главный ScrollView для всего контента -->
    <ScrollView BackgroundColor="#F5F5F7"
                VerticalOptions="FillAndExpand">
        
        <VerticalStackLayout Spacing="0"
                             HorizontalOptions="Fill"
                             VerticalOptions="Fill">
            
            <!-- Верхняя панель с выбором режима (теперь внутри скролла) -->
            <Grid BackgroundColor="#2C2C2E"
                  Padding="{OnPlatform iOS='12,40,12,12', MacCatalyst='12,40,12,12', Android='12,40,12,12', Default='15'}"
                  RowDefinitions="Auto,Auto"
                  RowSpacing="{OnPlatform iOS='8', MacCatalyst='10', Default='10'}">
                
                <Label Text="КРЕСТИКИ-НОЛИКИ"
                       Grid.Row="0"
                       FontSize="{OnPlatform iOS='22', MacCatalyst='26', Android='22', Default=24}"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
                
                <Grid Grid.Row="1"
                      ColumnDefinitions="*,*"
                      ColumnSpacing="{OnPlatform iOS='8', MacCatalyst='10', Android='8', Default='10'}"
                      Margin="{OnPlatform iOS='0,0,0,5', Default='0'}">
                    <Button x:Name="ClassicModeButton"
                            Text="КЛАССИКА"
                            BackgroundColor="#48484A"
                            TextColor="White"
                            CornerRadius="8"
                            FontSize="{OnPlatform iOS='14', MacCatalyst='15', Android='13', Default=14}"
                            FontAttributes="Bold"
                            HeightRequest="{OnPlatform iOS='44', MacCatalyst='42', Android='42', Default=40}"
                            Clicked="OnSwitchToClassicClicked" />
                    <Button x:Name="InfiniteModeButton"
                            Text="БЕСКОНЕЧНАЯ"
                            Grid.Column="1"
                            BackgroundColor="#48484A"
                            TextColor="White"
                            CornerRadius="8"
                            FontSize="{OnPlatform iOS='14', MacCatalyst='15', Android='13', Default=14}"
                            FontAttributes="Bold"
                            HeightRequest="{OnPlatform iOS='44', MacCatalyst='42', Android='42', Default=40}"
                            Clicked="OnSwitchToInfiniteClicked" />
                </Grid>
            </Grid>
            
            <!-- Основной контент -->
            <VerticalStackLayout x:Name="MainStackLayout"
                                 Spacing="{OnPlatform iOS='12', MacCatalyst='15', Android='12', Default=15}"
                                 Padding="{OnPlatform iOS='10,5,10,20', MacCatalyst='15,10,15,20', Android='12,8,12,20', Default='15,10,15,20'}"
                                 HorizontalOptions="Fill"
                                 VerticalOptions="Fill">
                
                <!-- Статус игры -->
                <Frame BackgroundColor="White"
                       CornerRadius="12"
                       Padding="{OnPlatform iOS='12', MacCatalyst='18', Android='12', Default='15'}"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="6">
                        <Grid ColumnDefinitions="*,*">
                            <Label x:Name="StatusLabel"
                                   Text="ХОД: ✕"
                                   FontSize="{OnPlatform iOS='16', MacCatalyst='20', Android='16', Default=18}"
                                   FontAttributes="Bold"
                                   TextColor="#2C2C2E" />
                            <Label x:Name="MovesLabel"
                                   Grid.Column="1"
                                   Text="ХОДОВ: 0"
                                   FontSize="{OnPlatform iOS='14', MacCatalyst='18', Android='14', Default=16}"
                                   HorizontalOptions="End"
                                   TextColor="#8E8E93" />
                        </Grid>
                        
                        <BoxView HeightRequest="1"
                                 BackgroundColor="#C6C6C8"
                                 HorizontalOptions="Fill"
                                 Margin="{OnPlatform iOS='0,4', Default='0,6'}" />
                        
                        <Grid ColumnDefinitions="*,*,*,*"
                              ColumnSpacing="{OnPlatform iOS='4', MacCatalyst='12', Android='6', Default='10'}">
                            <!-- Текущий игрок -->
                            <Frame CornerRadius="8"
                                   BackgroundColor="#F2F2F7"
                                   Padding="{OnPlatform iOS='6', MacCatalyst='12', Android='8', Default='10'}"
                                   HeightRequest="{OnPlatform iOS='55', MacCatalyst='65', Android='55', Default=60}">
                                <VerticalStackLayout Spacing="{OnPlatform iOS='2', Default='4'}"
                                                     HorizontalOptions="Center">
                                    <Label Text="ИГРОК"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#8E8E93" />
                                    <Label x:Name="CurrentPlayerLabel"
                                           Text="✕"
                                           FontSize="{OnPlatform iOS='22', MacCatalyst='26', Android='22', Default=24}"
                                           FontAttributes="Bold"
                                           TextColor="#007AFF" />
                                </VerticalStackLayout>
                            </Frame>
                            
                            <!-- Очки крестиков -->
                            <Frame CornerRadius="8"
                                   Grid.Column="1"
                                   BackgroundColor="#F2F2F7"
                                   Padding="{OnPlatform iOS='6', MacCatalyst='12', Android='8', Default='10'}"
                                   HeightRequest="{OnPlatform iOS='55', MacCatalyst='65', Android='55', Default=60}">
                                <VerticalStackLayout Spacing="{OnPlatform iOS='2', Default='4'}"
                                                     HorizontalOptions="Center">
                                    <Label Text="✕ ОЧКИ"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#8E8E93" />
                                    <Label x:Name="XScoreLabel"
                                           Text="0"
                                           FontSize="{OnPlatform iOS='20', MacCatalyst='22', Android='18', Default=20}"
                                           FontAttributes="Bold"
                                           TextColor="#FF3B30" />
                                </VerticalStackLayout>
                            </Frame>
                            
                            <!-- Очки ноликов -->
                            <Frame CornerRadius="8"
                                   Grid.Column="2"
                                   BackgroundColor="#F2F2F7"
                                   Padding="{OnPlatform iOS='6', MacCatalyst='12', Android='8', Default='10'}"
                                   HeightRequest="{OnPlatform iOS='55', MacCatalyst='65', Android='55', Default=60}">
                                <VerticalStackLayout Spacing="{OnPlatform iOS='2', Default='4'}"
                                                     HorizontalOptions="Center">
                                    <Label Text="○ ОЧКИ"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#8E8E93" />
                                    <Label x:Name="OScoreLabel"
                                           Text="0"
                                           FontSize="{OnPlatform iOS='20', MacCatalyst='22', Android='18', Default=20}"
                                           FontAttributes="Bold"
                                           TextColor="#007AFF" />
                                </VerticalStackLayout>
                            </Frame>
                            
                            <!-- Занято клеток -->
                            <Frame CornerRadius="8"
                                   Grid.Column="3"
                                   BackgroundColor="#F2F2F7"
                                   Padding="{OnPlatform iOS='6', MacCatalyst='12', Android='8', Default='10'}"
                                   HeightRequest="{OnPlatform iOS='55', MacCatalyst='65', Android='55', Default=60}">
                                <VerticalStackLayout Spacing="{OnPlatform iOS='2', Default='4'}"
                                                     HorizontalOptions="Center">
                                    <Label Text="ЗАНЯТО"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#8E8E93" />
                                    <Label x:Name="OccupiedLabel"
                                           Text="0"
                                           FontSize="{OnPlatform iOS='20', MacCatalyst='22', Android='18', Default=20}"
                                           FontAttributes="Bold"
                                           TextColor="#34C759" />
                                </VerticalStackLayout>
                            </Frame>
                        </Grid>
                        
                        <!-- Победитель -->
                        <Label x:Name="WinnerLabel"
                               Text=""
                               FontSize="{OnPlatform iOS='16', MacCatalyst='20', Android='16', Default=18}"
                               FontAttributes="Bold"
                               TextColor="#FF9500"
                               HorizontalOptions="Center"
                               IsVisible="False"
                               Margin="0,8,0,0" />
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Игровое поле -->
                <Frame BackgroundColor="White"
                       CornerRadius="12"
                       Padding="{OnPlatform iOS='12', MacCatalyst='15', Android='12', Default='15'}"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="{OnPlatform iOS='8', MacCatalyst='10', Android='8', Default='10'}">
                        <Grid ColumnDefinitions="*,Auto,*">
                            <Label Text="ИГРОВОЕ ПОЛЕ"
                                   FontSize="{OnPlatform iOS='15', MacCatalyst='18', Android='15', Default=16}"
                                   FontAttributes="Bold"
                                   TextColor="#2C2C2E" />
                            <Label x:Name="BorderInfoLabel"
                                   Grid.Column="1"
                                   Text="Граница: ±3"
                                   FontSize="{OnPlatform iOS='13', MacCatalyst='15', Android='13', Default=14}"
                                   TextColor="#8E8E93" />
                            <Label x:Name="WeightInfoLabel"
                                   Grid.Column="2"
                                   Text=""
                                   FontSize="{OnPlatform iOS='13', MacCatalyst='15', Android='13', Default=14}"
                                   HorizontalOptions="End"
                                   TextColor="#8E8E93" />
                        </Grid>
                        
                        <BoxView HeightRequest="1"
                                 BackgroundColor="#C6C6C8"
                                 HorizontalOptions="Fill" />
                        
                        <!-- Контейнер для поля с внутренним скроллом -->
                        <Border BackgroundColor="#F8F8F8"
                                Stroke="#D1D1D6"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 8"
                                HorizontalOptions="Center"
                                VerticalOptions="Center"
                                WidthRequest="{OnPlatform iOS=360, MacCatalyst=700, Android=350, Default=600}"
                                HeightRequest="{OnPlatform iOS=300, MacCatalyst=450, Android=300, Default=400}"
                                Margin="{OnPlatform iOS='0,0,0,10', Default='0'}">
                            
                            <!-- Внутренний ScrollView для игрового поля -->
                            <ScrollView x:Name="HorizontalScrollView"
                                        Orientation="Horizontal"
                                        HorizontalScrollBarVisibility="Always"
                                        VerticalScrollBarVisibility="Never"
                                        HorizontalOptions="Fill"
                                        VerticalOptions="Fill">
                                
                                <ScrollView x:Name="VerticalScrollView"
                                            Orientation="Vertical"
                                            HorizontalScrollBarVisibility="Never"
                                            VerticalScrollBarVisibility="Always"
                                            HorizontalOptions="Fill"
                                            VerticalOptions="Fill">
                                    
                                    <Grid x:Name="GameBoardOuterContainer"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          BackgroundColor="White">
                                        
                                        <AbsoluteLayout x:Name="GameBoardContainer" 
                                                      BackgroundColor="White"
                                                      HorizontalOptions="Center"
                                                      VerticalOptions="Center">
                                        </AbsoluteLayout>
                                        
                                    </Grid>
                                    
                                </ScrollView>
                                
                            </ScrollView>
                              
                        </Border>
                        
                        <!-- Информация о линиях (ДОБАВЛЕНО) -->
                        <Frame x:Name="LinesInfoFrame"
                               CornerRadius="8"
                               BackgroundColor="#F2F2F7"
                               Padding="{OnPlatform iOS='10', MacCatalyst='12', Android='8', Default='10'}"
                               Margin="0,8,0,0"
                               IsVisible="False">
                            <Grid ColumnDefinitions="*,*">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="✕ ЛИНИЯ"
                                           FontSize="{OnPlatform iOS='12', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#FF3B30"
                                           FontAttributes="Bold" />
                                    <Label x:Name="XLineInfoLabel"
                                           Text="0/5 клеток"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='12', Android='10', Default=11}"
                                           TextColor="#8E8E93" />
                                </VerticalStackLayout>
                                
                                <VerticalStackLayout Spacing="4"
                                                     Grid.Column="1">
                                    <Label Text="○ ЛИНИЯ"
                                           FontSize="{OnPlatform iOS='12', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#007AFF"
                                           FontAttributes="Bold" />
                                    <Label x:Name="OLineInfoLabel"
                                           Text="0/5 клеток"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='12', Android='10', Default=11}"
                                           TextColor="#8E8E93" />
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                        
                        <!-- Панель управления зумом -->
                        <Frame x:Name="ZoomControlFrame"
                               CornerRadius="8"
                               BackgroundColor="White"
                               Padding="10"
                               Margin="0,5,0,0"
                               HasShadow="True"
                               IsVisible="{OnPlatform iOS=False, MacCatalyst=True, Default=True}">
                            <VerticalStackLayout Spacing="4"
                                                 HorizontalOptions="Center"
                                                 VerticalOptions="Center">
                                <Grid ColumnDefinitions="Auto,*,Auto"
                                      HorizontalOptions="Center">
                                    <Button x:Name="ZoomOutButton"
                                            Text="-"
                                            Grid.Column="0"
                                            FontSize="{OnPlatform iOS='14', MacCatalyst='17', Android='15', Default=16}"
                                            FontAttributes="Bold"
                                            WidthRequest="{OnPlatform iOS=28, MacCatalyst=34, Android=30, Default=32}"
                                            HeightRequest="{OnPlatform iOS=28, MacCatalyst=34, Android=30, Default=32}"
                                            CornerRadius="14"
                                            BackgroundColor="#FF9500"
                                            TextColor="White"
                                            Clicked="OnZoomOutClicked" />
                                    
                                    <Label x:Name="ZoomLevelLabel"
                                           Text="100%"
                                           Grid.Column="1"
                                           FontSize="{OnPlatform iOS='11', MacCatalyst='13', Android='11', Default=12}"
                                           FontAttributes="Bold"
                                           HorizontalTextAlignment="Center"
                                           VerticalTextAlignment="Center"
                                           Margin="4,0,4,0"
                                           TextColor="#2C2C2E" />
                                    
                                    <Button x:Name="ZoomInButton"
                                            Text="+"
                                            Grid.Column="2"
                                            FontSize="{OnPlatform iOS='14', MacCatalyst='17', Android='15', Default=16}"
                                            FontAttributes="Bold"
                                            WidthRequest="{OnPlatform iOS=28, MacCatalyst=34, Android=30, Default=32}"
                                            HeightRequest="{OnPlatform iOS=28, MacCatalyst=34, Android=30, Default=32}"
                                            CornerRadius="14"
                                            BackgroundColor="#007AFF"
                                            TextColor="White"
                                            Clicked="OnZoomInClicked" />
                                </Grid>
                                
                                <Label Text="Масштаб"
                                       FontSize="{OnPlatform iOS='9', MacCatalyst='11', Android='9', Default=10}"
                                       HorizontalTextAlignment="Center"
                                       TextColor="#8E8E93" />
                                
                                <Button x:Name="ZoomResetButton"
                                        Text="⟲ Сброс"
                                        FontSize="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default=11}"
                                        FontAttributes="Bold"
                                        HeightRequest="{OnPlatform iOS=24, MacCatalyst=30, Android=26, Default=28}"
                                        CornerRadius="12"
                                        BackgroundColor="#AEAEB2"
                                        TextColor="White"
                                        HorizontalOptions="Center"
                                        Clicked="OnZoomResetClicked" />
                            </VerticalStackLayout>
                        </Frame>
                        
                        <!-- iOS панель зума (ДОБАВЛЕНО) -->
                        <Frame x:Name="iOSZoomControlFrame"
                               CornerRadius="8"
                               BackgroundColor="White"
                               Padding="10"
                               Margin="0,5,0,0"
                               HasShadow="True"
                               IsVisible="{OnPlatform iOS=True, Default=False}">
                            <Grid ColumnDefinitions="*,Auto,*"
                                  ColumnSpacing="10">
                                <Button x:Name="iOSZoomOutButton"
                                        Text="- Уменьшить"
                                        BackgroundColor="#FF9500"
                                        TextColor="White"
                                        CornerRadius="8"
                                        FontSize="13"
                                        FontAttributes="Bold"
                                        HeightRequest="36"
                                        HorizontalOptions="Fill"
                                        Clicked="OnZoomOutClicked" />
                                
                                <Label x:Name="iOSZoomLevelLabel"
                                       Text="100%"
                                       Grid.Column="1"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Center"
                                       VerticalTextAlignment="Center"
                                       TextColor="#2C2C2E" />
                                
                                <Button x:Name="iOSZoomInButton"
                                        Text="+ Увеличить"
                                        Grid.Column="2"
                                        BackgroundColor="#007AFF"
                                        TextColor="White"
                                        CornerRadius="8"
                                        FontSize="13"
                                        FontAttributes="Bold"
                                        HeightRequest="36"
                                        HorizontalOptions="Fill"
                                        Clicked="OnZoomInClicked" />
                            </Grid>
                        </Frame>
                        
                        <!-- Информация о поле -->
                        <Grid ColumnDefinitions="*,*"
                              ColumnSpacing="{OnPlatform iOS='8', MacCatalyst='12', Android='8', Default='10'}"
                              Margin="0,8,0,0">
                            <Frame CornerRadius="8"
                                   BackgroundColor="#F2F2F7"
                                   Padding="{OnPlatform iOS='8', MacCatalyst='10', Android='8', Default='8'}">
                                <HorizontalStackLayout Spacing="4"
                                                       HorizontalOptions="Center">
                                    <Label Text="Размер:"
                                           FontSize="{OnPlatform iOS='12', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#8E8E93" />
                                    <Label x:Name="RadiusLabel"
                                           Text="3"
                                           FontSize="{OnPlatform iOS='14', MacCatalyst='15', Android='13', Default=14}"
                                           FontAttributes="Bold"
                                           TextColor="#2C2C2E" />
                                </HorizontalStackLayout>
                            </Frame>
                            
                            <Frame CornerRadius="8"
                                   Grid.Column="1"
                                   BackgroundColor="#F2F2F7"
                                   Padding="{OnPlatform iOS='8', MacCatalyst='10', Android='8', Default='8'}">
                                <HorizontalStackLayout Spacing="4"
                                                       HorizontalOptions="Center">
                                    <Label Text="Клеток:"
                                           FontSize="{OnPlatform iOS='12', MacCatalyst='13', Android='11', Default=12}"
                                           TextColor="#8E8E93" />
                                    <Label x:Name="InfoLabel"
                                           Text="49"
                                           FontSize="{OnPlatform iOS='14', MacCatalyst='15', Android='13', Default=14}"
                                           FontAttributes="Bold"
                                           TextColor="#2C2C2E" />
                                </HorizontalStackLayout>
                            </Frame>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Панель управления -->
                <Frame BackgroundColor="White"
                       CornerRadius="12"
                       Padding="{OnPlatform iOS='12', MacCatalyst='15', Android='12', Default='15'}"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default='12'}">
                        <Label Text="УПРАВЛЕНИЕ"
                               FontSize="{OnPlatform iOS='15', MacCatalyst='18', Android='15', Default=16}"
                               FontAttributes="Bold"
                               TextColor="#2C2C2E" />
                        
                        <BoxView HeightRequest="1"
                                 BackgroundColor="#C6C6C8"
                                 HorizontalOptions="Fill" />
                        
                        <Grid ColumnDefinitions="*,*,*"
                              ColumnSpacing="{OnPlatform iOS='8', MacCatalyst='12', Android='8', Default='10'}">
                            <Button x:Name="NewGameButton"
                                    Text="НОВАЯ ИГРА"
                                    BackgroundColor="#007AFF"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='13', MacCatalyst='15', Android='13', Default=14}"
                                    FontAttributes="Bold"
                                    HeightRequest="{OnPlatform iOS='44', MacCatalyst='48', Android='42', Default=45}"
                                    Clicked="OnNewGameClicked" />
                            
                            <Button x:Name="UndoButton"
                                    Grid.Column="1"
                                    Text="ОТМЕНА"
                                    BackgroundColor="#8E8E93"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='13', MacCatalyst='15', Android='13', Default=14}"
                                    FontAttributes="Bold"
                                    HeightRequest="{OnPlatform iOS='44', MacCatalyst='48', Android='42', Default=45}"
                                    Clicked="OnUndoClicked" />
                            
                            <Button x:Name="AIMoveButton"
                                    Grid.Column="2"
                                    Text="ХОД ИИ"
                                    BackgroundColor="#34C759"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='13', MacCatalyst='15', Android='13', Default=14}"
                                    FontAttributes="Bold"
                                    HeightRequest="{OnPlatform iOS='44', MacCatalyst='48', Android='42', Default=45}"
                                    Clicked="OnAIMoveClicked" />
                        </Grid>
                        
                        <Grid x:Name="ClassicControls"
                              ColumnDefinitions="*,*"
                              ColumnSpacing="{OnPlatform iOS='8', MacCatalyst='12', Android='8', Default='10'}"
                              IsVisible="True">
                            <Button x:Name="ExpandButton"
                                    Text="+ РАСШИРИТЬ"
                                    BackgroundColor="#5AC8FA"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='12', MacCatalyst='14', Android='12', Default=13}"
                                    HeightRequest="{OnPlatform iOS='40', MacCatalyst='42', Android='38', Default=40}"
                                    Clicked="OnExpandClicked" />
                            
                            <Button x:Name="ShrinkButton"
                                    Text="- УМЕНЬШИТЬ"
                                    Grid.Column="1"
                                    BackgroundColor="#FF9500"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='12', MacCatalyst='14', Android='12', Default=13}"
                                    HeightRequest="{OnPlatform iOS='40', MacCatalyst='42', Android='38', Default=40}"
                                    Clicked="OnShrinkClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,*"
                              ColumnSpacing="{OnPlatform iOS='8', MacCatalyst='12', Android='8', Default='10'}">
                            <Button x:Name="ToggleEmptyButton"
                                    Text="СКРЫТЬ ПУСТЫЕ"
                                    BackgroundColor="#AEAEB2"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='12', MacCatalyst='14', Android='12', Default=13}"
                                    HeightRequest="{OnPlatform iOS='40', MacCatalyst='42', Android='38', Default=40}"
                                    Clicked="OnToggleEmptyClicked" />
                            
                            <Button x:Name="ToggleAutoExpandButton"
                                    Text="АВТОРАСШИРЕНИЕ"
                                    Grid.Column="1"
                                    BackgroundColor="#AEAEB2"
                                    TextColor="White"
                                    CornerRadius="8"
                                    FontSize="{OnPlatform iOS='12', MacCatalyst='14', Android='12', Default=13}"
                                    HeightRequest="{OnPlatform iOS='40', MacCatalyst='42', Android='38', Default=40}"
                                    Clicked="OnToggleAutoExpandClicked" />
                        </Grid>
                        
                        <Label x:Name="ModeInfoLabel"
                               Text="Классический режим: веса клеток отображаются цветом, победа по очкам"
                               FontSize="{OnPlatform iOS='11', MacCatalyst='13', Android='11', Default=12}"
                               TextColor="#8E8E93"
                               HorizontalOptions="Center"
                               LineBreakMode="WordWrap"
                               Margin="0,8,0,0" />
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Легенда весов -->
                <Frame x:Name="WeightLegend"
                       BackgroundColor="White"
                       CornerRadius="12"
                       Padding="{OnPlatform iOS='12', MacCatalyst='15', Android='12', Default='15'}"
                       HasShadow="True"
                       IsVisible="True">
                    <VerticalStackLayout Spacing="{OnPlatform iOS='8', MacCatalyst='10', Android='8', Default='10'}">
                        <Label Text="ЛЕГЕНДА ВЕСОВ КЛЕТОК"
                               FontSize="{OnPlatform iOS='15', MacCatalyst='18', Android='15', Default=16}"
                               FontAttributes="Bold"
                               TextColor="#2C2C2E" />
                        
                        <BoxView HeightRequest="1"
                                 BackgroundColor="#C6C6C8"
                                 HorizontalOptions="Fill" />
                        
                        <Grid ColumnDefinitions="*,*,*,*,*"
                              ColumnSpacing="{OnPlatform iOS='5', MacCatalyst='6', Android='4', Default='5'}">
                            <Frame CornerRadius="6"
                                   BackgroundColor="#E3F2FD"
                                   HeightRequest="{OnPlatform iOS='32', MacCatalyst='32', Android='28', Default=30}">
                                <Label Text="1.0"
                                       FontSize="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default=11}"
                                       TextColor="#1565C0"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <Frame CornerRadius="6"
                                   Grid.Column="1"
                                   BackgroundColor="#BBDEFB"
                                   HeightRequest="{OnPlatform iOS='32', MacCatalyst='32', Android='28', Default=30}">
                                <Label Text="2.0"
                                       FontSize="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default=11}"
                                       TextColor="#1565C0"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <Frame CornerRadius="6"
                                   Grid.Column="2"
                                   BackgroundColor="#90CAF9"
                                   HeightRequest="{OnPlatform iOS='32', MacCatalyst='32', Android='28', Default=30}">
                                <Label Text="3.0"
                                       FontSize="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default=11}"
                                       TextColor="#1565C0"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <Frame CornerRadius="6"
                                   Grid.Column="3"
                                   BackgroundColor="#64B5F6"
                                   HeightRequest="{OnPlatform iOS='32', MacCatalyst='32', Android='28', Default=30}">
                                <Label Text="4.0"
                                       FontSize="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default=11}"
                                       TextColor="White"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <Frame CornerRadius="6"
                                   Grid.Column="4"
                                   BackgroundColor="#2196F3"
                                   HeightRequest="{OnPlatform iOS='32', MacCatalyst='32', Android='28', Default=30}">
                                <Label Text="5.0+"
                                       FontSize="{OnPlatform iOS='10', MacCatalyst='12', Android='10', Default=11}"
                                       TextColor="White"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Пустое пространство для скролла -->
                <BoxView HeightRequest="50"
                         Color="Transparent" />
                
            </VerticalStackLayout>
            
        </VerticalStackLayout>
        
    </ScrollView>
    
</ContentPage>